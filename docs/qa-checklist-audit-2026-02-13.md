# QA Checklist: Audit Verification

Дата: 13 февраля 2026

Цель: проверить, что все критичные потоки после технического аудита работают стабильно.

## 1. Предусловия

1. Поднять Postgres и убедиться, что доступна БД `youtoobe`.
2. Выполнить миграции и сиды:

```bash
npm run migrate
npm run seed
```

3. Запустить backend и frontend:

```bash
npm run dev
```

Ожидаемо:
- Backend на `http://localhost:3001`
- Frontend на `http://localhost:5173`

## 2. Автоматические проверки

### Server tests

```bash
cd server
npm test
```

Ожидаемо: `All server tests passed`.

### Client tests

```bash
cd client
npm test
```

Ожидаемо: `All client tests passed`.

## 3. Ручной smoke (E2E)

### A. Auth + profile

1. Открыть `/auth` и войти через Google.
2. Проверить открытие dashboard.

Ожидаемо:
- Пользователь авторизован.
- Нет ошибок 401/500 в консоли браузера.

### B. Offers contract

1. Как неавторизованный пользователь нажать “Пропозиції” на публичной странице.
2. Проверить переход на `/auth?next=/offers`.
3. После логина убедиться, что происходит возврат на `/offers`.

Ожидаемо:
- Явный и корректный auth redirect.
- Нет “ложных” переходов на приватную страницу без объяснения.

### C. Multi-channel behavior

1. У пользователя с несколькими каналами создать оффер, выбрав канал в форме.
2. Проверить, что оффер создается от выбранного канала.
3. Проверить `/offers/my` (видны офферы всех каналов пользователя).

Ожидаемо:
- Канал для действия выбирается корректно.
- Нет конфликтов владения.

### D. Swap lifecycle

1. Откликнуться на оффер вторым пользователем.
2. Принять swap владельцем target-канала.
3. В отдельном потоке проверить decline swap.

Ожидаемо:
- Accept переводит в `accepted`.
- Decline переводит в `rejected`, оффер переоткрывается.

### E. Chat + complete flow

1. Отправить сообщение в чат по активному match.
2. Выполнить подтверждение завершения с обеих сторон.

Ожидаемо:
- Сообщение сохраняется и отображается.
- После двух подтверждений статус `completed`.

### F. Reviews delayed publish

1. Создать review по завершенному обмену.
2. Проверить публичные страницы channel/reviews до публикации.

Ожидаемо:
- Непубликованный review не отображается публично (`isPublished=false` не должен уходить в выдачу).

### G. Global notifications

1. На dashboard проверить иконку колокольчика.
2. Сгенерировать событие (accept/reject/confirm swap).
3. Проверить toast и список уведомлений.

Ожидаемо:
- Новое уведомление появляется в списке.
- Переход по `link` в уведомлении работает.

### H. PWA assets

1. Открыть `/manifest.json`.
2. Проверить, что все `icons.src` отдаются без 404.

Ожидаемо:
- Все иконки доступны.
- Нет ошибок загрузки assets.

## 4. Критерии PASS/FAIL

PASS:
- Все автотесты проходят.
- Все пункты ручного smoke выполняются согласно ожиданиям.
- Нет критичных 500/uncaught ошибок в консоли/логах.

FAIL:
- Любой endpoint из core flow недоступен/ломает сценарий.
- Нарушен контракт auth redirect или multi-channel.
- Публично видны непубликованные reviews.
- Есть 404 по PWA-иконкам из manifest.

## 5. Артефакты при дефекте

При падении любого пункта зафиксировать:
1. URL и точные шаги воспроизведения.
2. HTTP status и response body.
3. Backend лог события (JSON-лог, если есть).
4. Скриншот/видео (для UI-дефектов).
